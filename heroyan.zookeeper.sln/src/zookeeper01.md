# 一、ZooKeeper简介

标签（空格分隔）： Zookeeper学习笔记

------

## 1、Zookeeper是什么

> 1、ZooKeeper是源代码开发的分布式协调服务，是一个高性能的分布式数据一致性解决方案，它将那些复杂的、容易出错的分布式一致性服务封装起来，提供一系列简单易用的接口给用户使用；
> 2、顺序一致性：从一个客户单发起一个事务请求，最终会严格按照其发起的顺序被应用到ZooKeeper中去；
> 3、原子性：所有事务请求的处理的结果在整个集群所有机器上应用情况是一致的；
> 4、单一视图：无论客户端连接到哪个ZooKeeper的服务器，它看到的服务端的数据都是一致的；
> 5、可靠性：一旦服务端成功的执行了一个事务，并完成了对客户端的响应，这个事务所引起的服务端的状态变更会一致保存下来，除非有另外一个事务又对它进行了修改；
> 6、实时性：ZooKeeper保证在一段时间内客户端最终一定能从服务端读取到最新的数据状态；
> 7、高性能：一个三台的ZooKeeper集群可以达到12-13W的QPS。

## 2、ZooKeeper的典型应用场景

### 2.1、数据发布/订阅

> 1、发布者将数据发布到ZK集群节点上，订阅者通过一定的方法告诉服务器，我对哪个节点的数据感兴趣，那服务器在这些节点的数据发生变化的时候，就通知客户端，客户端得到通知后可以去服务器获取数据信息。

### 2.2、负载均衡

> 1、服务注册与发现就是一个很好的例子。

### 2.3、命名服务

> 1、提供名称的服务，例如数据库的ID，自增ID/UUID，两种ID都有缺陷，自增ID只能在单库单表中使用，不能在分布式中使用，UUID可以在分布式中使用但是由于ID没有规律难于理解，我们可以用ZooKeeper来生成一个顺序增长的，可以在集群环境下使用的，易于理解的ID。

### 2.4、分布式协调/通知

> 1、心跳检测：在分布式系统中，我们常常需要知道某个机器是否可用，传统的开发中，可以通过ping某个主机来实现，ZK中我们可以注册一个临时节点，我们判断一个机器是否可用，我们只需要判断这个节点在ZK中是否存在就可以了，不需要直接去连接需要检查的机器，降低系统的复杂度。

## 3、ZooKeeper的基本概念

### 3.1、集群角色

> 1、Leader：服务器是整个ZK集群工作机制中的核心；
> 2、Follower：服务器是ZK集群状态的跟随者；
> 3、Observer：服务器充当一个观察者的角色。

### 3.2、会话

> 1、会话是指客户端和ZK服务器的连接，ZK中的会话叫session，客户端与服务器建立一个TCP的长连接来维持一个session，客户端在启动的时候首先会与服务器建立一个TCP连接，通过这个连接，客户端能够通过心跳检测与服务器保持有效的会话，也能向ZK服务器发送请求并获得响应。

### 3.3、数据节点

> 1、集群中的一台机器称为一个节点；
> 2、数据模型中的数据单元znode，分为持久节点和临时节点；
> 3、ZK的数据模型是一棵树，数的节点就是znode，znode中可以保持信息。

### 3.4、版本

> 1、version：当前数据节点数据内容的版本号；
> 2、cversion：当前数据节点子节点的版本号；
> 3、aversion：当前数据节点ACL变更的版本号。

### 3.5、watcher

> 1、事件监听器：ZooKeeper允许用户在指定节点注册一些watcher，当数据节点变化的时候，ZooKeeper服务器会把这个变化的通知发送给感兴趣的客户端。

### 3.6、ACL权限控制

> 1、ACL是Access Control Lists的简写，ZooKeeper采用ACL策略来进行权限控制；
> 2、CREATE：创建子节点的权限；
> 3、READ：获取节点数据和子节点列表的权限；
> 4、WRITE：更新节点数据的权限；
> 5、DELETE：删除子节点的权限；
> 6、ADMIN：设置节点ACL的权限。

## 4、ZooKeeper环境搭建

### 4.1、单机环境

> 1、

### 4.2、伪集群

